#!/bin/bash

# Output CSV file
REPORT_FILE="report.csv"

# Write header
echo "Name,Height (m),Weight (kg)" > "$REPORT_FILE"

# Loop through all JSON files
for file in *.json; do
    if [ -f "$file" ]; then
        # Extract values using jq
        name=$(jq -r '.name' "$file")
        height=$(jq -r '.height' "$file")
        weight=$(jq -r '.weight' "$file")

        # Convert height from decimeters to meters
        height_m=$(echo "$height" | awk '{printf "%.1f", $1 / 10}')

        # Convert weight from hectograms to kilograms
        weight_kg=$(echo "$weight" | awk '{printf "%.1f", $1 / 10}')

        # Capitalize the name
        name_cap=$(echo "$name" | sed 's/.*/\u&/')

        # Append to CSV
        echo "$name_cap,$height_m,$weight_kg" >> "$REPORT_FILE"
    fi
done

echo "✅ Report generated: $REPORT_FILE"

# Calculate average height and weight using awk
echo ""
echo "�� Averages:"
awk -F',' 'NR>1 {h+=$2; w+=$3; count+=1} END {
    printf "Average Height: %.2f m\n", h/count
    printf "Average Weight: %.2f kg\n", w/count
}' "$REPORT_FILE"
